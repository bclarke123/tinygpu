<!doctype html>
<html>
    <head>
        <title>tinygpu example: Blinn-Phong material</title>
        <style type="text/css">
            body {
                margin: 0;
                overflow: hidden;
            }

            canvas {
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
            }
        </style>
    </head>

    <body>
        <canvas id="canvas"></canvas>
        <script src="../dist/index.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                const canvas = document.getElementById("canvas");
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                const renderer = new tinygpu.Renderer({ canvas });
                await renderer.init();

                const scene = renderer.createScene();
                const camera = renderer.createPerspectiveCamera();

                const createMesh = (geoType) => {
                    const geo = renderer.createGeometry(geoType);
                    const mat = renderer.createMaterial(
                        tinygpu.material.BlinnPhongMaterial,
                        { shininess: 0.6 },
                    );
                    const mesh = renderer.createMesh(geo, mat);
                    return mesh;
                };

                const cube = createMesh(tinygpu.geometry.CubeGeometry);
                scene.add(cube);

                const light = new tinygpu.lights.Light(1, new tinygpu.Color(0.7, 0.7, 0.8), 0.8);
                light.setPosition(4, 3, 5);
                scene.add(light);

                const ambient = new tinygpu.lights.Light(0, new tinygpu.Color(1.0, 0.0, 1.0));
                scene.add(ambient);

                const animate = () => {
                    const now = performance.now() / 1000;

                    // const cr = 10.0;
                    // camera.setPosition(Math.cos(now * 0.7) * cr, 0, Math.sin(now * 0.7) * cr);
                    // camera.setTarget([0, 0, 0]);

                    cube.setRotation(0, now, now * 0.7);
                    renderer.render(scene, camera);
                    requestAnimationFrame(animate);
                };

                animate();
            });
        </script>
    </body>
</html>
