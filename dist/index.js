!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("tinygpu",[],e):"object"==typeof exports?exports.tinygpu=e():t.tinygpu=e()}(self,(()=>(()=>{"use strict";var t={35:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Material=void 0,e.Material=class{constructor(t){this._uniformManager=t}get bindGroupLayout(){var t;return null===(t=this._uniformManager)||void 0===t?void 0:t.bindGroupLayout}get bindGroup(){var t;return null===(t=this._uniformManager)||void 0===t?void 0:t.bindGroup}update(){var t;null===(t=this._uniformManager)||void 0===t||t.update()}}},41:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const r=n(541),i=n(717),o=n(343);class a extends r.Transform{constructor(t){super(),this._uniformManager=new o.UniformManager(t,[{name:"projection matrix",value:i.mat4.create()},{name:"view matrix",value:i.mat4.create()},{name:"camera position",value:i.vec3.create()},{name:"resolution",value:i.vec2.create(1,1)},{name:"time",value:performance.now()/1e3}])}update(t,e){this._uniformManager.updateUniform({name:"projection matrix",value:t.projectionMatrix}),this._uniformManager.updateUniform({name:"view matrix",value:t.viewMatrix}),this._uniformManager.updateUniform({name:"camera position",value:t.position}),this._uniformManager.updateUniform({name:"resolution",value:e}),this._uniformManager.updateUniform({name:"time",value:performance.now()/1e3}),this._uniformManager.update()}get bindGroupLayout(){return this._uniformManager.bindGroupLayout}get bindGroup(){return this._uniformManager.bindGroup}}e.Scene=a},43:(t,e,n)=>{n.r(e),n.d(e,{default:()=>r});const r="struct Uniforms {\n  color: vec4<f32>\n}\n\n@group(BG_UNIFORMS) @binding(0) var<uniform> uniforms: Uniforms;\n@group(BG_UNIFORMS) @binding(1) var tex_sampler: sampler;\n@group(BG_UNIFORMS) @binding(2) var tex_map: texture_2d<f32>;\n\nstruct VSOut {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n}\n\n@vertex\nfn vs_main(@location(0) in_pos: vec3<f32>, @location(1) uv: vec2<f32>) -> VSOut {\n  let modelViewProj: mat4x4<f32> = scene_uniforms.projection * scene_uniforms.view * model_uniforms.model;\n\n  let vs_out: VSOut = VSOut(\n    modelViewProj * vec4<f32>(in_pos, 1.0),\n    uv,\n  );\n  return vs_out;\n}\n\n@fragment\nfn fs_main(vs_out: VSOut) -> @location(0) vec4<f32> {\n  let color: vec4<f32> = textureSample(tex_map, tex_sampler, vs_out.uv);\n  return color * uniforms.color;\n}\n"},80:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=void 0,e.Geometry=class{constructor(t,e,n,r,i,o){this._renderer=t,this._vertexBuffer=e,this._indexBuffer=n,this._uvBuffer=r,this._indexCount=i,this._vertexCount=o}get device(){return this._renderer.device}get vertexBuffer(){return this._vertexBuffer}get indexBuffer(){return this._indexBuffer}get indexCount(){return this._indexCount}get vertexCount(){return this._vertexCount}get uvBuffer(){return this._uvBuffer}}},108:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mesh=void 0;const r=n(541),i=n(343);class o extends r.Transform{constructor(t,e,n){super(),this._device=t,this.material=e,this.geometry=n,this._uniformManager=new i.UniformManager(t,[{name:"model",value:this.worldMatrix}],[],"Mesh")}get cacheKey(){return`${this.geometry.cacheKey}-${this.material.cacheKey}`}update(){this.material.update(),this._uniformManager.updateUniform({name:"model",value:this.worldMatrix}),this._uniformManager.update()}get bindGroupLayout(){return this._uniformManager.bindGroupLayout}get bindGroup(){return this._uniformManager.bindGroup}}e.Mesh=o},149:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OrthographicCamera=e.PerspectiveCamera=e.Camera=void 0;var r=n(534);Object.defineProperty(e,"Camera",{enumerable:!0,get:function(){return r.Camera}});var i=n(599);Object.defineProperty(e,"PerspectiveCamera",{enumerable:!0,get:function(){return i.PerspectiveCamera}});var o=n(779);Object.defineProperty(e,"OrthographicCamera",{enumerable:!0,get:function(){return o.OrthographicCamera}})},161:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CubeGeometry=void 0;const r=n(80);class i extends r.Geometry{constructor(t){const{vertices:e,indices:n,vertexCount:r,indexCount:i,arrayStride:o}=function(){const t=[[-.5,-.5,.5,0,1,0,0,1],[.5,-.5,.5,1,1,0,0,1],[.5,.5,.5,1,0,0,0,1],[-.5,.5,.5,0,0,0,0,1],[.5,-.5,-.5,1,1,0,0,-1],[-.5,-.5,-.5,0,1,0,0,-1],[-.5,.5,-.5,0,0,0,0,-1],[.5,.5,-.5,1,0,0,0,-1],[.5,-.5,.5,0,1,1,0,0],[.5,-.5,-.5,1,1,1,0,0],[.5,.5,-.5,1,0,1,0,0],[.5,.5,.5,0,0,1,0,0],[-.5,-.5,-.5,1,1,-1,0,0],[-.5,-.5,.5,0,1,-1,0,0],[-.5,.5,.5,0,0,-1,0,0],[-.5,.5,-.5,1,0,-1,0,0],[-.5,.5,.5,0,1,0,1,0],[.5,.5,.5,1,1,0,1,0],[.5,.5,-.5,1,0,0,1,0],[-.5,.5,-.5,0,0,0,1,0],[-.5,-.5,-.5,0,1,0,-1,0],[.5,-.5,-.5,1,1,0,-1,0],[.5,-.5,.5,1,0,0,-1,0],[-.5,-.5,.5,0,0,0,-1,0]],e=[];t.forEach((t=>e.push(...t)));const n=new Float32Array(e),r=t.length,i=[];for(let t=0;t<6;t++){const e=4*t;i.push(e+0,e+1,e+2,e+0,e+2,e+3)}const o=new Uint16Array(i);return{vertices:n,indices:o,vertexCount:r,indexCount:o.length,arrayStride:32,floatsPerVertex:8}}(),a=t.createBuffer(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),s=t.createBuffer(n,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST);super(t,a,s,a,i,r),this._arrayStride=o}get cacheKey(){return"CubeGeometry"}get bufferLayout(){return[{arrayStride:this._arrayStride,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x2"},{shaderLocation:2,offset:20,format:"float32x3"}]}]}}e.CubeGeometry=i},192:(t,e,n)=>{n.r(e),n.d(e,{default:()=>r});const r="struct VSOut {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv: vec2<f32>,\n}\n\n@vertex\nfn vs_main(@location(0) in_pos: vec3<f32>, @location(1) uv: vec2<f32>) -> VSOut {\n  let modelViewProj: mat4x4<f32> = scene_uniforms.projection * scene_uniforms.view * model_uniforms.model;\n\n  let vs_out: VSOut = VSOut(\n    modelViewProj * vec4<f32>(in_pos, 1.0),\n    uv,\n  );\n  return vs_out;\n}\n\n@fragment\nfn fs_main(vs_out: VSOut) -> @location(0) vec4<f32> {\n  return vec4(vs_out.uv, 0.0, 1.0);\n}\n"},249:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.packUniforms=function(t,e,n=0){let r=0,a=0;const s=[];if(0===t.length&&!e)return new ArrayBuffer(0);if(0===t.length&&e)return e;for(const e of t){const t=o(e),n=i[t];if(!n)throw new Error(`Layout info not defined for type: ${t}`);const u=n.align,c=n.size;a=Math.max(a,u),r+=(u-r%u)%u;const l={relativeOffset:r,size:c,type:t,data:e,paddedStride:n.paddedStride};s.push(l),r+=n.advanceAmount}const u=r+(a-r%a)%a;let c,l;if(e){if(e.byteLength<n+u)throw new Error(`Target buffer is too small. Need ${u} bytes starting at offset ${n}, but buffer size is ${e.byteLength} bytes.`);c=e,l=n}else c=new ArrayBuffer(u),l=0;const h=new DataView(c),f=new Float32Array(c);for(const t of s){const e=l+t.relativeOffset,n=t.data.value;switch(t.type){case"f32":h.setFloat32(e,t.data.value,!0);break;case"color":f.set(t.data.value.uniformValue(),e/4);break;case"vec2":case"vec4":case"mat4":case"vec3":f.set(n,e/4);break;case"mat3":const r=t.paddedStride/4;for(let t=0;t<3;++t){const i=3*t,o=e/4+t*r;f.set(n.subarray(i,i+3),o)}}}return c},e.uploadUniformBuffer=function(t,e,n="Uniform Buffer",r){return null!=r||(r=e.createBuffer({label:n,size:t.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM})),e.queue.writeBuffer(r,0,t,0,t.byteLength),r};const r=n(710),i={f32:{align:4,size:4,advanceAmount:4,paddedStride:4},vec2:{align:8,size:8,advanceAmount:8,paddedStride:8},vec3:{align:16,size:12,advanceAmount:16,paddedStride:16},vec4:{align:16,size:16,advanceAmount:16,paddedStride:16},color:{align:16,size:16,advanceAmount:16,paddedStride:16},mat3:{align:16,size:36,advanceAmount:48,paddedStride:16},mat4:{align:16,size:64,advanceAmount:64,paddedStride:16}};function o(t){if("number"==typeof t.value)return"f32";if(t.value instanceof r.Color)return"color";if(!(t.value instanceof Float32Array))throw new Error(`Unsupported data type in item ${t.name} for uniform packing: ${typeof t.value}`);switch(t.value.length){case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";case 9:return"mat3";case 16:return"mat4";default:throw new Error(`Unsupported Float32Array length in item ${t.name} for uniform packing: ${t.value.length}`)}}},325:function(t,e,n){var r,i=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(r=function(t){return r=Object.getOwnPropertyNames||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[e.length]=n);return e},r(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n=r(t),a=0;a<n.length;a++)"default"!==n[a]&&i(e,t,n[a]);return o(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.compute=e.material=e.geometry=e.camera=e.Transform=e.Scene=e.ImageTexture=e.DefaultTexture=e.Color=e.Renderer=void 0;var s=n(366);Object.defineProperty(e,"Renderer",{enumerable:!0,get:function(){return s.Renderer}});var u=n(710);Object.defineProperty(e,"Color",{enumerable:!0,get:function(){return u.Color}});var c=n(330);Object.defineProperty(e,"DefaultTexture",{enumerable:!0,get:function(){return c.DefaultTexture}}),Object.defineProperty(e,"ImageTexture",{enumerable:!0,get:function(){return c.ImageTexture}});var l=n(41);Object.defineProperty(e,"Scene",{enumerable:!0,get:function(){return l.Scene}});var h=n(541);Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return h.Transform}}),e.camera=a(n(149)),e.geometry=a(n(722)),e.material=a(n(760)),e.compute=a(n(898))},330:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ImageTexture=e.DefaultTexture=e.Texture=void 0;class r{constructor(){}}e.Texture=r;class i extends r{constructor(){super(),this._texture=null,this._textureView=null,this._pixelData=new Uint8Array([255,255,255,255])}get width(){return 1}get height(){return 1}get descriptor(){return{size:{width:1,height:1,depthOrArrayLayers:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,dimension:"2d",mipLevelCount:1,sampleCount:1}}get view(){var t;if(!this._texture)throw new Error("Texture not created");return null!==(t=this._textureView)&&void 0!==t||(this._textureView=this._texture.createView()),this._textureView}get label(){return"Default Texture"}upload(t){this._texture||(this._texture=t.createTexture(this.descriptor),t.queue.writeTexture({texture:this._texture,mipLevel:0,origin:{x:0,y:0,z:0}},this._pixelData,{offset:0,bytesPerRow:4,rowsPerImage:1},{width:1,height:1,depthOrArrayLayers:1}))}dispose(){var t;null===(t=this._texture)||void 0===t||t.destroy(),this._texture=null,this._textureView=null}}e.DefaultTexture=i,i.instance=new i,e.ImageTexture=class extends r{constructor(t){super(),this._width=0,this._height=0,this._texture=null,this._textureView=null,this._imagedata=null,this.src=t}load(){return n(this,void 0,void 0,(function*(){const t=yield fetch(this.src);if(!t.ok)throw new Error(`Failed to load image: ${this.src}`);const e=yield t.blob(),n=yield createImageBitmap(e);this._imagedata=n,this._width=n.width,this._height=n.height}))}get width(){return this._width}get height(){return this._height}get descriptor(){return{size:{width:this._width,height:this._height,depthOrArrayLayers:1},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,dimension:"2d",mipLevelCount:1,sampleCount:1}}get view(){var t;if(!this._texture)throw new Error("Texture not created");return null!==(t=this._textureView)&&void 0!==t||(this._textureView=this._texture.createView()),this._textureView}get label(){return`ImageTexture ${this.src}`}upload(t){if(!this._texture){if(!this._imagedata)throw new Error("Image not loaded");this._texture=t.createTexture(this.descriptor),t.queue.copyExternalImageToTexture({source:this._imagedata,origin:{x:0,y:0},flipY:!0},{texture:this._texture,origin:{x:0,y:0}},{width:this._width,height:this._height,depthOrArrayLayers:1})}}dispose(){var t,e;null===(t=this._imagedata)||void 0===t||t.close(),null===(e=this._texture)||void 0===e||e.destroy(),this._texture=null,this._textureView=null,this._imagedata=null,this._width=0,this._height=0}}},331:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.UVMaterial=void 0;const i=n(35),o=r(n(414)),a=r(n(192));class s extends i.Material{constructor(t){super(),s.precompile(t)}get cacheKey(){return"UVMaterial"}get shaderCode(){return s.shaderModule}static precompile(t){s.shaderModule||(s.shaderModule=t.createShaderModule({label:"basic-material-shader",code:`\n${o.default}\n${a.default}\n`}))}}e.UVMaterial=s,s.shaderModule=null},343:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UniformManager=void 0;const r=n(249);e.UniformManager=class{constructor(t,e,n,r){this._uniformDirty=!0,this._texturesDirty=!0,this._device=t,this._uniforms=e,this._textures=n,this._label=r}updateUniform(t){var e;(null===(e=this._uniforms)||void 0===e?void 0:e.find((e=>e.name===t.name))).value=t.value,this.setUniformsDirty()}updateTextures(t){this._textures=t,this._texturesDirty=!0}update(){this._uniformDirty&&(this._uniformArr=(0,r.packUniforms)(this._uniforms||[],this._uniformArr),this._uniformBuffer=(0,r.uploadUniformBuffer)(this._uniformArr,this._device,this._label,this._uniformBuffer),this._uniformDirty=!1),this._texturesDirty&&((this._textures||[]).forEach((t=>t.upload(this._device))),this._texturesDirty=!1)}setTexturesDirty(){this._texturesDirty=!0}setUniformsDirty(){this._uniformDirty=!0}setDirty(){this.setTexturesDirty(),this.setUniformsDirty()}get sampler(){return this._sampler||(this._sampler=this._device.createSampler({magFilter:"linear",minFilter:"linear"})),this._sampler}get bindGroupLayoutDescriptor(){const t=[];let e=0;const{_uniforms:n,_textures:r}=this;if((null==n?void 0:n.length)>0&&(t.push({binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform",hasDynamicOffset:!1,minBindingSize:0}}),e++),(null==r?void 0:r.length)>0){t.push({binding:e,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}),e++;for(let n=0;n<(null==r?void 0:r.length);n++)t.push({binding:n+e,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return{label:`${this._label} BindGroup Layout`,entries:t}}get bindGroupLayout(){return this._bindGroupLayout||(this._bindGroupLayout=this._device.createBindGroupLayout(this.bindGroupLayoutDescriptor)),this._bindGroupLayout}get bindGroupDescriptor(){let t=0;const{_uniforms:e,_textures:n}=this,r=[];if((null==e?void 0:e.length)>0&&(r.push({binding:t,resource:{buffer:this._uniformBuffer}}),t++),(null==n?void 0:n.length)>0){r.push({binding:t,resource:this.sampler}),t++;for(let e=0;e<(null==n?void 0:n.length);e++)r.push({binding:e+t,resource:n[e].view})}return{label:`${this._label} BindGroup`,layout:this.bindGroupLayout,entries:r}}get bindGroup(){return this._bindGroup||(this._bindGroup=this._device.createBindGroup(this.bindGroupDescriptor)),this._bindGroup}}},366:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const i=n(717),o=n(779),a=n(599),s=n(108),u=n(41);e.Renderer=class{constructor(t={}){var e;this.adapter=null,this.depthFormat="depth24plus-stencil8",this.format="bgra8unorm",this.canvasSize=i.vec2.create(1,1),this.sizeDirty=!0,this._pipelineCache=new Map,this._computePipelineCache=new Map,null!==(e=this.canvas)&&void 0!==e||(this.canvas=t.canvas),console.log("Renderer initialized")}init(){return r(this,void 0,void 0,(function*(){if(!navigator.gpu)throw new Error("WebGPU is not supported in this browser");if(this.adapter=yield navigator.gpu.requestAdapter(),!this.adapter)throw new Error("No GPU adapter found");this.device=yield this.adapter.requestDevice(),console.log("GPU device initialized"),this.canvas&&this.initCanvas(this.canvas)}))}initCanvas(t){var e;if(this.canvas=t,this.context=null===(e=this.canvas)||void 0===e?void 0:e.getContext("webgpu"),!this.context)throw new Error("Failed to get WebGPU context");this.format=navigator.gpu.getPreferredCanvasFormat(),console.log(this.format),this.context.configure({device:this.device,format:this.format,alphaMode:"premultiplied"});const n=()=>{var t;const e=this.canvas.offsetWidth,n=this.canvas.offsetHeight;this.canvas.width=e,this.canvas.height=n,this.canvasSize.set([e,n]),this.sizeDirty=!0,null===(t=this.depthTexture)||void 0===t||t.destroy(),this.depthTexture=this.device.createTexture({label:"Depth texture",size:{width:e,height:n},format:this.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView({label:"Depth texture view "})};n(),this.resizeObserver=new ResizeObserver(n),this.resizeObserver.observe(this.canvas),console.log("Canvas initialized")}createBuffer(t,e){const n=this.device.createBuffer({size:t.byteLength+3&-4,usage:e,mappedAtCreation:!0});return t instanceof Float32Array?new Float32Array(n.getMappedRange()).set(t):t instanceof Uint16Array?new Uint16Array(n.getMappedRange()).set(t):t instanceof Uint8Array&&new Uint8Array(n.getMappedRange()).set(t),n.unmap(),n}pipelineFor(t,e){const n=e.cacheKey;if(this._pipelineCache.has(n))return this._pipelineCache.get(n);const r=e.material.shaderCode,i=e.geometry.bufferLayout,o=this.device.createPipelineLayout({label:"Pipeline Layout",bindGroupLayouts:[t.bindGroupLayout,e.bindGroupLayout,e.material.bindGroupLayout]}),a=this.device.createRenderPipeline({layout:o,vertex:{module:r,buffers:i},fragment:{module:r,targets:[{format:this.format}]},primitive:{topology:"triangle-list",stripIndexFormat:void 0,frontFace:"ccw",cullMode:"back"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}});return this._pipelineCache.set(n,a),a}render(t,e){const[n,r]=this.canvasSize,i={label:"Render pass",colorAttachments:[{view:this.context.getCurrentTexture().createView({label:"Canvas output texture view"}),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilLoadOp:"clear",stencilStoreOp:"store"}},o=this.device.createCommandEncoder(),a=o.beginRenderPass(i);a.setViewport(0,0,n,r,0,1),a.setScissorRect(0,0,n,r),this.sizeDirty&&(e.viewportResized(this.canvasSize),this.sizeDirty=!1),t.update(e,this.canvasSize);const u=t.bindGroup;a.setBindGroup(0,u),t.traverse((e=>{if(e instanceof s.Mesh){const n=e;n.update();const r=this.pipelineFor(t,n);a.setPipeline(r),a.setVertexBuffer(0,n.geometry.vertexBuffer),a.setVertexBuffer(1,n.geometry.uvBuffer),a.setIndexBuffer(n.geometry.indexBuffer,"uint16"),a.setBindGroup(1,n.bindGroup),a.setBindGroup(2,n.material.bindGroup),a.drawIndexed(n.geometry.indexCount)}})),a.end(),this.device.queue.submit([o.finish()])}computePipelineFor(t){if(!this._computePipelineCache[t.cacheKey]){const e=t.getBindGroupLayout(this.device),n=this.device.createPipelineLayout({label:`${t.label} Pipeline Layout`,bindGroupLayouts:[e]}),r=this.device.createComputePipeline({layout:n,compute:{module:t.shaderModule}});this._computePipelineCache[t.cacheKey]=r}return this._computePipelineCache[t.cacheKey]}compute(t){const e=this.device.createCommandEncoder(),n=e.beginComputePass();for(const e of t){const t=this.computePipelineFor(e),r=e.workgroupSize,i=e.getBindGroup(this.device);n.setPipeline(t),n.setBindGroup(0,i),n.dispatchWorkgroups(r[0],r[1],r[2])}n.end(),this.device.queue.submit([e.finish()])}createMaterial(t,e){return new t(this.device,e)}createGeometry(t){return new t(this)}createMesh(t,e){return new s.Mesh(this.device,e,t)}createScene(){return new u.Scene(this.device)}createPerspectiveCamera(t){return new a.PerspectiveCamera(t)}createOrthographicCamera(t){return new o.OrthographicCamera(t)}}},414:(t,e,n)=>{n.r(e),n.d(e,{default:()=>r});const r="const BG_SCENE: u32 = 0;\nconst BG_MODEL: u32 = 1;\nconst BG_UNIFORMS: u32 = 2;\n\nstruct SceneUniforms {\n  projection: mat4x4<f32>,\n  view: mat4x4<f32>,\n  camera_position: vec3<f32>,\n  resolution: vec2<f32>,\n  time: f32,\n}\n\nstruct ModelUniforms {\n  model: mat4x4<f32>,\n}\n\n@group(BG_SCENE) @binding(0) var<uniform> scene_uniforms: SceneUniforms;\n@group(BG_MODEL) @binding(0) var<uniform> model_uniforms: ModelUniforms;\n"},534:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const r=n(717),i=n(541);class o extends i.Transform{constructor(){super(),this._isProjectionDirty=!0,this._isViewDirty=!0,this._projectionMatrix=r.mat4.identity(),this._viewMatrix=r.mat4.identity(),this._isProjectionDirty=!0,this._isViewDirty=!0}get projectionMatrix(){return this._isProjectionDirty&&this.updateProjectionMatrix(),this._projectionMatrix}get viewMatrix(){return this._isViewDirty&&this.updateViewMatrix(),this._viewMatrix}updateMatrices(){this._isProjectionDirty&&this.updateProjectionMatrix(),this._isViewDirty&&this.updateViewMatrix()}}e.Camera=o},541:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Transform=void 0;const r=n(717);e.Transform=class{constructor(){this._children=[],this._position=r.vec3.create(0,0,0),this._rotation=r.quat.identity(),this._scale=r.vec3.create(1,1,1),this._localMatrix=r.mat4.identity(),this._worldMatrix=r.mat4.identity(),this._localDirty=!0,this._worldDirty=!0}get position(){return this._position}get quaternion(){return this._rotation}get scale(){return this._scale}set position(t){r.vec3.equals(this._position,t)||(this._position=r.vec3.copy(t,this._position),this.makeDirty())}set quaternion(t){r.quat.equals(this._rotation,t)||(this._rotation=r.quat.copy(t,this._rotation),this.makeDirty())}setRotation(t,e,n,i="xyz"){this._rotation=r.quat.fromEuler(t,e,n,i),this.makeDirty()}set scale(t){r.vec3.equals(this._scale,t)||(this._scale=r.vec3.copy(t,this._scale),this.makeDirty())}get localMatrix(){return this._localDirty&&this.updateLocalMatrix(),this._localMatrix}get worldMatrix(){return(this._localDirty||this._worldDirty)&&this.updateWorldMatrix(),this._worldMatrix}updateLocalMatrix(){!function(t,e,n,i){i||(i=r.mat4.create());const[o,a,s,u]=e,c=o+o,l=a+a,h=s+s,f=o*c,d=a*l,p=s*h,m=o*l,v=o*h,M=a*h,g=u*c,_=u*l,w=u*h,[y,b,x]=n;i[0]=(1-(d+p))*y,i[1]=(m+w)*y,i[2]=(v-_)*y,i[3]=0,i[4]=(m-w)*b,i[5]=(1-(f+p))*b,i[6]=(M+g)*b,i[7]=0,i[8]=(v+_)*x,i[9]=(M-g)*x,i[10]=(1-(f+d))*x,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1}(this._position,this._rotation,this._scale,this._localMatrix),this._localDirty=!1,this._worldDirty=!0}updateWorldMatrix(){this._localDirty&&this.updateLocalMatrix(),this._parent?r.mat4.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):r.mat4.copy(this.localMatrix,this._worldMatrix),this._worldDirty=!1;for(const t of this._children)t._worldDirty=!0}makeDirty(){this._localDirty=!0,this._worldDirty=!0;for(const t of this._children)t._worldDirty||t.makeWorldDirty()}makeWorldDirty(){if(!this._worldDirty){this._worldDirty=!0;for(const t of this._children)t.makeWorldDirty()}}get children(){return this._children}add(t){t._parent!==this&&(t._parent&&t._parent.remove(t),-1===this._children.indexOf(t)&&(this._children.push(t),t._parent=this,t.makeWorldDirty()))}remove(t){const e=this._children.indexOf(t);-1!==e&&(this._children.splice(e,1),t._parent=void 0,t.makeWorldDirty())}clear(){for(const t of this._children)t._parent=void 0,t.makeWorldDirty();this._children=[]}traverse(t){t(this);for(const e of this._children)e.traverse(t)}}},599:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PerspectiveCamera=void 0;const r=n(717),i=n(534);class o extends i.Camera{constructor({fov:t=Math.PI/4,aspect:e=16/9,near:n=.1,far:i=1e3,position:o=r.vec3.create(0,0,10),target:a=r.vec3.create(0,0,0),up:s=r.vec3.create(0,1,0)}={}){super(),this.fov=t,this.aspect=e,this.near=n,this.far=i,this.position=r.vec3.clone(o),this.target=r.vec3.clone(a),this.up=r.vec3.clone(s)}updateProjectionMatrix(){console.log("Updating Projection Matrix using wgpu-matrix"),this._projectionMatrix=r.mat4.perspective(this.fov,this.aspect,this.near,this.far),this._isProjectionDirty=!1}updateViewMatrix(){console.log("Updating View Matrix using wgpu-matrix"),this._viewMatrix=r.mat4.lookAt(this.position,this.target,this.up),this._isViewDirty=!1}setPosition(t){r.vec3.equals(this.position,t)||(this.position=r.vec3.copy(t,this.position),this._isViewDirty=!0)}setTarget(t){r.vec3.equals(this.target,t)||(this.target=r.vec3.copy(t,this.target),this._isViewDirty=!0)}setUp(t){r.vec3.equals(this.up,t)||(this.up=r.vec3.copy(t,this.up),this._isViewDirty=!0)}setFov(t){this.fov!==t&&(this.fov=t,this._isProjectionDirty=!0)}setAspect(t){this.aspect!==t&&(this.aspect=t,this._isProjectionDirty=!0)}setNear(t){this.near!==t&&(this.near=t,this._isProjectionDirty=!0)}setFar(t){this.far!==t&&(this.far=t,this._isProjectionDirty=!0)}viewportResized(t){this.setAspect(t[0]/t[1])}}e.PerspectiveCamera=o},657:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BigTriangle=void 0;const r=n(80);class i extends r.Geometry{constructor(t){const e=t.createBuffer(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),GPUBufferUsage.VERTEX),n=t.createBuffer(new Uint16Array([0,1,2]),GPUBufferUsage.INDEX),r=t.createBuffer(new Float32Array([0,0,2,0,0,2]),GPUBufferUsage.VERTEX);super(t,e,n,r,3,3)}get cacheKey(){return"big-triangle"}get bufferLayout(){return[{attributes:[{shaderLocation:0,offset:0,format:"float32x3"}],arrayStride:12,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"}]}}e.BigTriangle=i},710:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;const r=n(717);e.Color=class{constructor(t,e,n,r=1){this.r=t,this.g=e,this.b=n,this.a=r}uniformValue(){var t;return null!==(t=this.buffer)&&void 0!==t||(this.buffer=r.vec4.create()),this.buffer.set([this.r,this.g,this.b,this.a]),this.buffer}}},717:(t,e,n)=>{n.r(e),n.d(e,{mat3:()=>y,mat3d:()=>G,mat3n:()=>q,mat4:()=>b,mat4d:()=>O,mat4n:()=>A,quat:()=>x,quatd:()=>U,quatn:()=>B,utils:()=>s,vec2:()=>P,vec2d:()=>T,vec2n:()=>V,vec3:()=>S,vec3d:()=>j,vec3n:()=>L,vec4:()=>D,vec4d:()=>C,vec4n:()=>z});const r=(i=Array,o=t=>t.fill(0),class extends i{constructor(...t){super(...t),o(this)}});var i,o;let a=1e-6;var s={__proto__:null,get EPSILON(){return a},degToRad:function(t){return t*Math.PI/180},euclideanModulo:function(t,e){return(t%e+e)%e},inverseLerp:function(t,e,n){const r=e-t;return Math.abs(e-t)<a?t:(n-t)/r},lerp:function(t,e,n){return t+(e-t)*n},radToDeg:function(t){return 180*t/Math.PI},setEpsilon:function(t){const e=a;return a=t,e}};const u=new Map;function c(t){let e=u.get(t);return e||(e=function(t){function e(e=0,n=0){const r=new t(2);return void 0!==e&&(r[0]=e,void 0!==n&&(r[1]=n)),r}function n(e,n,r){const i=r??new t(2);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i}function r(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o}function i(e,n,r){const i=r??new t(2);return i[0]=e[0]*n,i[1]=e[1]*n,i}function o(e,n){const r=n??new t(2);return r[0]=1/e[0],r[1]=1/e[1],r}function s(t,e){return t[0]*e[0]+t[1]*e[1]}function u(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function c(t){const e=t[0],n=t[1];return e*e+n*n}function l(t,e){const n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function h(t,e){const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function f(e,n){const r=n??new t(2),i=e[0],o=e[1],a=Math.sqrt(i*i+o*o);return a>1e-5?(r[0]=i/a,r[1]=o/a):(r[0]=0,r[1]=0),r}function d(e,n){const r=n??new t(2);return r[0]=e[0],r[1]=e[1],r}function p(e,n,r){const i=r??new t(2);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i}function m(e,n,r){const i=r??new t(2);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i}function v(e,n,r){const o=r??new t(2);return f(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r){const i=r??new t(2);return i[0]=e,i[1]=n,i},ceil:function(e,n){const r=n??new t(2);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r},floor:function(e,n){const r=n??new t(2);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r},round:function(e,n){const r=n??new t(2);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(2);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o},add:function(e,n,r){const i=r??new t(2);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i},addScaled:function(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o},angle:function(t,e){const n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),u=a&&s(t,e)/a;return Math.acos(u)},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(2);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o},max:function(e,n,r){const i=r??new t(2);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i},min:function(e,n,r){const i=r??new t(2);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(2);return i[0]=e[0]/n,i[1]=e[1]/n,i},inverse:o,invert:o,cross:function(e,n,r){const i=r??new t(3),o=e[0]*n[1]-e[1]*n[0];return i[0]=0,i[1]=0,i[2]=o,i},dot:s,length:u,len:u,lengthSq:c,lenSq:c,distance:l,dist:l,distanceSq:h,distSq:h,normalize:f,negate:function(e,n){const r=n??new t(2);return r[0]=-e[0],r[1]=-e[1],r},copy:d,clone:d,multiply:p,mul:p,divide:m,div:m,random:function(e=1,n){const r=n??new t(2),i=2*Math.random()*Math.PI;return r[0]=Math.cos(i)*e,r[1]=Math.sin(i)*e,r},zero:function(e){const n=e??new t(2);return n[0]=0,n[1]=0,n},transformMat4:function(e,n,r){const i=r??new t(2),o=e[0],a=e[1];return i[0]=o*n[0]+a*n[4]+n[12],i[1]=o*n[1]+a*n[5]+n[13],i},transformMat3:function(e,n,r){const i=r??new t(2),o=e[0],a=e[1];return i[0]=n[0]*o+n[4]*a+n[8],i[1]=n[1]*o+n[5]*a+n[9],i},rotate:function(e,n,r,i){const o=i??new t(2),a=e[0]-n[0],s=e[1]-n[1],u=Math.sin(r),c=Math.cos(r);return o[0]=a*c-s*u+n[0],o[1]=a*u+s*c+n[1],o},setLength:v,truncate:function(e,n,r){const i=r??new t(2);return u(e)>n?v(e,n,i):d(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(2))}}}(t),u.set(t,e)),e}const l=new Map;function h(t){let e=l.get(t);return e||(e=function(t){function e(e,n,r){const i=new t(3);return void 0!==e&&(i[0]=e,void 0!==n&&(i[1]=n,void 0!==r&&(i[2]=r))),i}function n(e,n,r){const i=r??new t(3);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function r(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o}function i(e,n,r){const i=r??new t(3);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function o(e,n){const r=n??new t(3);return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function s(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function u(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function c(t){const e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function l(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function h(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function f(e,n){const r=n??new t(3),i=e[0],o=e[1],a=e[2],s=Math.sqrt(i*i+o*o+a*a);return s>1e-5?(r[0]=i/s,r[1]=o/s,r[2]=a/s):(r[0]=0,r[1]=0,r[2]=0),r}function d(e,n){const r=n??new t(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function p(e,n,r){const i=r??new t(3);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function m(e,n,r){const i=r??new t(3);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i}function v(e,n,r){const o=r??new t(3);return f(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r,i){const o=i??new t(3);return o[0]=e,o[1]=n,o[2]=r,o},ceil:function(e,n){const r=n??new t(3);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r},floor:function(e,n){const r=n??new t(3);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r},round:function(e,n){const r=n??new t(3);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(3);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o[2]=Math.min(r,Math.max(n,e[2])),o},add:function(e,n,r){const i=r??new t(3);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},addScaled:function(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o[2]=e[2]+n[2]*r,o},angle:function(t,e){const n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],u=e[2],c=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+u*u),l=c&&s(t,e)/c;return Math.acos(l)},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(3);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o[2]=e[2]+r[2]*(n[2]-e[2]),o},max:function(e,n,r){const i=r??new t(3);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i},min:function(e,n,r){const i=r??new t(3);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(3);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i},inverse:o,invert:o,cross:function(e,n,r){const i=r??new t(3),o=e[2]*n[0]-e[0]*n[2],a=e[0]*n[1]-e[1]*n[0];return i[0]=e[1]*n[2]-e[2]*n[1],i[1]=o,i[2]=a,i},dot:s,length:u,len:u,lengthSq:c,lenSq:c,distance:l,dist:l,distanceSq:h,distSq:h,normalize:f,negate:function(e,n){const r=n??new t(3);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r},copy:d,clone:d,multiply:p,mul:p,divide:m,div:m,random:function(e=1,n){const r=n??new t(3),i=2*Math.random()*Math.PI,o=2*Math.random()-1,a=Math.sqrt(1-o*o)*e;return r[0]=Math.cos(i)*a,r[1]=Math.sin(i)*a,r[2]=o*e,r},zero:function(e){const n=e??new t(3);return n[0]=0,n[1]=0,n[2]=0,n},transformMat4:function(e,n,r){const i=r??new t(3),o=e[0],a=e[1],s=e[2],u=n[3]*o+n[7]*a+n[11]*s+n[15]||1;return i[0]=(n[0]*o+n[4]*a+n[8]*s+n[12])/u,i[1]=(n[1]*o+n[5]*a+n[9]*s+n[13])/u,i[2]=(n[2]*o+n[6]*a+n[10]*s+n[14])/u,i},transformMat4Upper3x3:function(e,n,r){const i=r??new t(3),o=e[0],a=e[1],s=e[2];return i[0]=o*n[0]+a*n[4]+s*n[8],i[1]=o*n[1]+a*n[5]+s*n[9],i[2]=o*n[2]+a*n[6]+s*n[10],i},transformMat3:function(e,n,r){const i=r??new t(3),o=e[0],a=e[1],s=e[2];return i[0]=o*n[0]+a*n[4]+s*n[8],i[1]=o*n[1]+a*n[5]+s*n[9],i[2]=o*n[2]+a*n[6]+s*n[10],i},transformQuat:function(e,n,r){const i=r??new t(3),o=n[0],a=n[1],s=n[2],u=2*n[3],c=e[0],l=e[1],h=e[2],f=a*h-s*l,d=s*c-o*h,p=o*l-a*c;return i[0]=c+f*u+2*(a*p-s*d),i[1]=l+d*u+2*(s*f-o*p),i[2]=h+p*u+2*(o*d-a*f),i},getTranslation:function(e,n){const r=n??new t(3);return r[0]=e[12],r[1]=e[13],r[2]=e[14],r},getAxis:function(e,n,r){const i=r??new t(3),o=4*n;return i[0]=e[o+0],i[1]=e[o+1],i[2]=e[o+2],i},getScaling:function(e,n){const r=n??new t(3),i=e[0],o=e[1],a=e[2],s=e[4],u=e[5],c=e[6],l=e[8],h=e[9],f=e[10];return r[0]=Math.sqrt(i*i+o*o+a*a),r[1]=Math.sqrt(s*s+u*u+c*c),r[2]=Math.sqrt(l*l+h*h+f*f),r},rotateX:function(e,n,r,i){const o=i??new t(3),a=[],s=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],s[0]=a[0],s[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),s[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),o[0]=s[0]+n[0],o[1]=s[1]+n[1],o[2]=s[2]+n[2],o},rotateY:function(e,n,r,i){const o=i??new t(3),a=[],s=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],s[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),s[1]=a[1],s[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),o[0]=s[0]+n[0],o[1]=s[1]+n[1],o[2]=s[2]+n[2],o},rotateZ:function(e,n,r,i){const o=i??new t(3),a=[],s=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],s[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),s[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),s[2]=a[2],o[0]=s[0]+n[0],o[1]=s[1]+n[1],o[2]=s[2]+n[2],o},setLength:v,truncate:function(e,n,r){const i=r??new t(3);return u(e)>n?v(e,n,i):d(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(3))}}}(t),l.set(t,e)),e}const f=new Map;function d(t){let e=f.get(t);return e||(e=function(t){const e=c(t),n=h(t);function r(e,n,r){const i=r??new t(12);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i}function i(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[8]=e[8],r[9]=e[9],r[10]=e[10],r}function o(e){const n=e??new t(12);return n[0]=1,n[1]=0,n[2]=0,n[4]=0,n[5]=1,n[6]=0,n[8]=0,n[9]=0,n[10]=1,n}function s(e,n){const r=n??new t(12),i=e[0],o=e[1],a=e[2],s=e[4],u=e[5],c=e[6],l=e[8],h=e[9],f=e[10],d=f*u-c*h,p=-f*s+c*l,m=h*s-u*l,v=1/(i*d+o*p+a*m);return r[0]=d*v,r[1]=(-f*o+a*h)*v,r[2]=(c*o-a*u)*v,r[4]=p*v,r[5]=(f*i-a*l)*v,r[6]=(-c*i+a*s)*v,r[8]=m*v,r[9]=(-h*i+o*l)*v,r[10]=(u*i-o*s)*v,r}function u(e,n,r){const i=r??new t(12),o=e[0],a=e[1],s=e[2],u=e[4],c=e[5],l=e[6],h=e[8],f=e[9],d=e[10],p=n[0],m=n[1],v=n[2],M=n[4],g=n[5],_=n[6],w=n[8],y=n[9],b=n[10];return i[0]=o*p+u*m+h*v,i[1]=a*p+c*m+f*v,i[2]=s*p+l*m+d*v,i[4]=o*M+u*g+h*_,i[5]=a*M+c*g+f*_,i[6]=s*M+l*g+d*_,i[8]=o*w+u*y+h*b,i[9]=a*w+c*y+f*b,i[10]=s*w+l*y+d*b,i}function l(e,n){const r=n??new t(12),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=o,r[2]=0,r[4]=-o,r[5]=i,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r}function f(e,n,r){const i=r??new t(12),o=e[0],a=e[1],s=e[2],u=e[4],c=e[5],l=e[6],h=Math.cos(n),f=Math.sin(n);return i[0]=h*o+f*u,i[1]=h*a+f*c,i[2]=h*s+f*l,i[4]=h*u-f*o,i[5]=h*c-f*a,i[6]=h*l-f*s,e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i}return{add:function(e,n,r){const i=r??new t(12);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[8]=e[8]+n[8],i[9]=e[9]+n[9],i[10]=e[10]+n[10],i},clone:i,copy:i,create:function(e,n,r,i,o,a,s,u,c){const l=new t(12);return l[3]=0,l[7]=0,l[11]=0,void 0!==e&&(l[0]=e,void 0!==n&&(l[1]=n,void 0!==r&&(l[2]=r,void 0!==i&&(l[4]=i,void 0!==o&&(l[5]=o,void 0!==a&&(l[6]=a,void 0!==s&&(l[8]=s,void 0!==u&&(l[9]=u,void 0!==c&&(l[10]=c))))))))),l},determinant:function(t){const e=t[0],n=t[1],r=t[2],i=t[4],o=t[5],a=t[6],s=t[8],u=t[9],c=t[10];return e*(o*c-u*a)-i*(n*c-u*r)+s*(n*a-o*r)},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]},equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[4]-e[4])<a&&Math.abs(t[5]-e[5])<a&&Math.abs(t[6]-e[6])<a&&Math.abs(t[8]-e[8])<a&&Math.abs(t[9]-e[9])<a&&Math.abs(t[10]-e[10])<a},fromMat4:function(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=0,r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=0,r},fromQuat:function(e,n){const r=n??new t(12),i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,l=a+a,h=i*u,f=o*u,d=o*c,p=a*u,m=a*c,v=a*l,M=s*u,g=s*c,_=s*l;return r[0]=1-d-v,r[1]=f+_,r[2]=p-g,r[3]=0,r[4]=f-_,r[5]=1-h-v,r[6]=m+M,r[7]=0,r[8]=p+g,r[9]=m-M,r[10]=1-h-d,r[11]=0,r},get3DScaling:function(t,e){const r=e??n.create(),i=t[0],o=t[1],a=t[2],s=t[4],u=t[5],c=t[6],l=t[8],h=t[9],f=t[10];return r[0]=Math.sqrt(i*i+o*o+a*a),r[1]=Math.sqrt(s*s+u*u+c*c),r[2]=Math.sqrt(l*l+h*h+f*f),r},getAxis:function(t,n,r){const i=r??e.create(),o=4*n;return i[0]=t[o+0],i[1]=t[o+1],i},getScaling:function(t,n){const r=n??e.create(),i=t[0],o=t[1],a=t[4],s=t[5];return r[0]=Math.sqrt(i*i+o*o),r[1]=Math.sqrt(a*a+s*s),r},getTranslation:function(t,n){const r=n??e.create();return r[0]=t[8],r[1]=t[9],r},identity:o,inverse:s,invert:s,mul:u,mulScalar:r,multiply:u,multiplyScalar:r,negate:function(e,n){const r=n??new t(12);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[8]=-e[8],r[9]=-e[9],r[10]=-e[10],r},rotate:f,rotateX:function(e,n,r){const i=r??new t(12),o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10],h=Math.cos(n),f=Math.sin(n);return i[4]=h*o+f*u,i[5]=h*a+f*c,i[6]=h*s+f*l,i[8]=h*u-f*o,i[9]=h*c-f*a,i[10]=h*l-f*s,e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),i},rotateY:function(e,n,r){const i=r??new t(12),o=e[0],a=e[1],s=e[2],u=e[8],c=e[9],l=e[10],h=Math.cos(n),f=Math.sin(n);return i[0]=h*o-f*u,i[1]=h*a-f*c,i[2]=h*s-f*l,i[8]=h*u+f*o,i[9]=h*c+f*a,i[10]=h*l+f*s,e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6]),i},rotateZ:f,rotation:l,rotationX:function(e,n){const r=n??new t(12),i=Math.cos(e),o=Math.sin(e);return r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=i,r[6]=o,r[8]=0,r[9]=-o,r[10]=i,r},rotationY:function(e,n){const r=n??new t(12),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=0,r[2]=-o,r[4]=0,r[5]=1,r[6]=0,r[8]=o,r[9]=0,r[10]=i,r},rotationZ:l,scale:function(e,n,r){const i=r??new t(12),o=n[0],a=n[1];return i[0]=o*e[0],i[1]=o*e[1],i[2]=o*e[2],i[4]=a*e[4],i[5]=a*e[5],i[6]=a*e[6],e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i},scale3D:function(e,n,r){const i=r??new t(12),o=n[0],a=n[1],s=n[2];return i[0]=o*e[0],i[1]=o*e[1],i[2]=o*e[2],i[4]=a*e[4],i[5]=a*e[5],i[6]=a*e[6],i[8]=s*e[8],i[9]=s*e[9],i[10]=s*e[10],i},scaling:function(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=0,r[2]=0,r[4]=0,r[5]=e[1],r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},scaling3D:function(e,n){const r=n??new t(12);return r[0]=e[0],r[1]=0,r[2]=0,r[4]=0,r[5]=e[1],r[6]=0,r[8]=0,r[9]=0,r[10]=e[2],r},set:function(e,n,r,i,o,a,s,u,c,l){const h=l??new t(12);return h[0]=e,h[1]=n,h[2]=r,h[3]=0,h[4]=i,h[5]=o,h[6]=a,h[7]=0,h[8]=s,h[9]=u,h[10]=c,h[11]=0,h},setAxis:function(t,e,n,r){const o=r===t?t:i(t,r),a=4*n;return o[a+0]=e[0],o[a+1]=e[1],o},setTranslation:function(t,e,n){const r=n??o();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[4]=t[4],r[5]=t[5],r[6]=t[6]),r[8]=e[0],r[9]=e[1],r[10]=1,r},translate:function(e,n,r){const i=r??new t(12),o=n[0],a=n[1],s=e[0],u=e[1],c=e[2],l=e[4],h=e[5],f=e[6],d=e[8],p=e[9],m=e[10];return e!==i&&(i[0]=s,i[1]=u,i[2]=c,i[4]=l,i[5]=h,i[6]=f),i[8]=s*o+l*a+d,i[9]=u*o+h*a+p,i[10]=c*o+f*a+m,i},translation:function(e,n){const r=n??new t(12);return r[0]=1,r[1]=0,r[2]=0,r[4]=0,r[5]=1,r[6]=0,r[8]=e[0],r[9]=e[1],r[10]=1,r},transpose:function(e,n){const r=n??new t(12);if(r===e){let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,r}const i=e[0],o=e[1],a=e[2],s=e[4],u=e[5],c=e[6],l=e[8],h=e[9],f=e[10];return r[0]=i,r[1]=s,r[2]=l,r[4]=o,r[5]=u,r[6]=h,r[8]=a,r[9]=c,r[10]=f,r},uniformScale:function(e,n,r){const i=r??new t(12);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[4]=n*e[4],i[5]=n*e[5],i[6]=n*e[6],e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10]),i},uniformScale3D:function(e,n,r){const i=r??new t(12);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[4]=n*e[4],i[5]=n*e[5],i[6]=n*e[6],i[8]=n*e[8],i[9]=n*e[9],i[10]=n*e[10],i},uniformScaling:function(e,n){const r=n??new t(12);return r[0]=e,r[1]=0,r[2]=0,r[4]=0,r[5]=e,r[6]=0,r[8]=0,r[9]=0,r[10]=1,r},uniformScaling3D:function(e,n){const r=n??new t(12);return r[0]=e,r[1]=0,r[2]=0,r[4]=0,r[5]=e,r[6]=0,r[8]=0,r[9]=0,r[10]=e,r}}}(t),f.set(t,e)),e}const p=new Map;function m(t){let e=p.get(t);return e||(e=function(t){const e=h(t);function n(e,n,r){const i=r??new t(16);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=e[11]*n,i[12]=e[12]*n,i[13]=e[13]*n,i[14]=e[14]*n,i[15]=e[15]*n,i}const r=n;function i(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}const o=i;function s(e){const n=e??new t(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function u(e,n){const r=n??new t(16),i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],c=e[5],l=e[6],h=e[7],f=e[8],d=e[9],p=e[10],m=e[11],v=e[12],M=e[13],g=e[14],_=e[15],w=p*_,y=g*m,b=l*_,x=g*h,P=l*m,S=p*h,D=a*_,G=g*s,O=a*m,U=p*s,T=a*h,j=l*s,C=f*M,q=v*d,A=u*M,B=v*c,V=u*d,L=f*c,z=i*M,E=v*o,F=i*d,R=f*o,k=i*c,I=u*o,N=w*c+x*d+P*M-(y*c+b*d+S*M),$=y*o+D*d+U*M-(w*o+G*d+O*M),K=b*o+G*c+T*M-(x*o+D*c+j*M),X=S*o+O*c+j*d-(P*o+U*c+T*d),W=1/(i*N+u*$+f*K+v*X);return r[0]=W*N,r[1]=W*$,r[2]=W*K,r[3]=W*X,r[4]=W*(y*u+b*f+S*v-(w*u+x*f+P*v)),r[5]=W*(w*i+G*f+O*v-(y*i+D*f+U*v)),r[6]=W*(x*i+D*u+j*v-(b*i+G*u+T*v)),r[7]=W*(P*i+U*u+T*f-(S*i+O*u+j*f)),r[8]=W*(C*h+B*m+V*_-(q*h+A*m+L*_)),r[9]=W*(q*s+z*m+R*_-(C*s+E*m+F*_)),r[10]=W*(A*s+E*h+k*_-(B*s+z*h+I*_)),r[11]=W*(L*s+F*h+I*m-(V*s+R*h+k*m)),r[12]=W*(A*p+L*g+q*l-(V*g+C*l+B*p)),r[13]=W*(F*g+C*a+E*p-(z*p+R*g+q*a)),r[14]=W*(z*l+I*g+B*a-(k*g+A*a+E*l)),r[15]=W*(k*p+V*a+R*l-(F*l+I*p+L*a)),r}const c=u;function l(e,n,r){const i=r??new t(16),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],f=e[7],d=e[8],p=e[9],m=e[10],v=e[11],M=e[12],g=e[13],_=e[14],w=e[15],y=n[0],b=n[1],x=n[2],P=n[3],S=n[4],D=n[5],G=n[6],O=n[7],U=n[8],T=n[9],j=n[10],C=n[11],q=n[12],A=n[13],B=n[14],V=n[15];return i[0]=o*y+c*b+d*x+M*P,i[1]=a*y+l*b+p*x+g*P,i[2]=s*y+h*b+m*x+_*P,i[3]=u*y+f*b+v*x+w*P,i[4]=o*S+c*D+d*G+M*O,i[5]=a*S+l*D+p*G+g*O,i[6]=s*S+h*D+m*G+_*O,i[7]=u*S+f*D+v*G+w*O,i[8]=o*U+c*T+d*j+M*C,i[9]=a*U+l*T+p*j+g*C,i[10]=s*U+h*T+m*j+_*C,i[11]=u*U+f*T+v*j+w*C,i[12]=o*q+c*A+d*B+M*V,i[13]=a*q+l*A+p*B+g*V,i[14]=s*q+h*A+m*B+_*V,i[15]=u*q+f*A+v*B+w*V,i}const f=l,d=e.create(),p=e.create(),m=e.create();function v(e,n,r){const i=r??new t(16);let o=e[0],a=e[1],s=e[2];const u=Math.sqrt(o*o+a*a+s*s);o/=u,a/=u,s/=u;const c=o*o,l=a*a,h=s*s,f=Math.cos(n),d=Math.sin(n),p=1-f;return i[0]=c+(1-c)*f,i[1]=o*a*p+s*d,i[2]=o*s*p-a*d,i[3]=0,i[4]=o*a*p-s*d,i[5]=l+(1-l)*f,i[6]=a*s*p+o*d,i[7]=0,i[8]=o*s*p+a*d,i[9]=a*s*p-o*d,i[10]=h+(1-h)*f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function M(e,n,r,i){const o=i??new t(16);let a=n[0],s=n[1],u=n[2];const c=Math.sqrt(a*a+s*s+u*u);a/=c,s/=c,u/=c;const l=a*a,h=s*s,f=u*u,d=Math.cos(r),p=Math.sin(r),m=1-d,v=l+(1-l)*d,M=a*s*m+u*p,g=a*u*m-s*p,_=a*s*m-u*p,w=h+(1-h)*d,y=s*u*m+a*p,b=a*u*m+s*p,x=s*u*m-a*p,P=f+(1-f)*d,S=e[0],D=e[1],G=e[2],O=e[3],U=e[4],T=e[5],j=e[6],C=e[7],q=e[8],A=e[9],B=e[10],V=e[11];return o[0]=v*S+M*U+g*q,o[1]=v*D+M*T+g*A,o[2]=v*G+M*j+g*B,o[3]=v*O+M*C+g*V,o[4]=_*S+w*U+y*q,o[5]=_*D+w*T+y*A,o[6]=_*G+w*j+y*B,o[7]=_*O+w*C+y*V,o[8]=b*S+x*U+P*q,o[9]=b*D+x*T+P*A,o[10]=b*G+x*j+P*B,o[11]=b*O+x*C+P*V,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}return{add:function(e,n,r){const i=r??new t(16);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i[4]=e[4]+n[4],i[5]=e[5]+n[5],i[6]=e[6]+n[6],i[7]=e[7]+n[7],i[8]=e[8]+n[8],i[9]=e[9]+n[9],i[10]=e[10]+n[10],i[11]=e[11]+n[11],i[12]=e[12]+n[12],i[13]=e[13]+n[13],i[14]=e[14]+n[14],i[15]=e[15]+n[15],i},aim:function(n,r,i,o){const a=o??new t(16);return e.normalize(e.subtract(r,n,m),m),e.normalize(e.cross(i,m,d),d),e.normalize(e.cross(m,d,p),p),a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=0,a[4]=p[0],a[5]=p[1],a[6]=p[2],a[7]=0,a[8]=m[0],a[9]=m[1],a[10]=m[2],a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a},axisRotate:M,axisRotation:v,cameraAim:function(n,r,i,o){const a=o??new t(16);return e.normalize(e.subtract(n,r,m),m),e.normalize(e.cross(i,m,d),d),e.normalize(e.cross(m,d,p),p),a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=0,a[4]=p[0],a[5]=p[1],a[6]=p[2],a[7]=0,a[8]=m[0],a[9]=m[1],a[10]=m[2],a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a},clone:o,copy:i,create:function(e,n,r,i,o,a,s,u,c,l,h,f,d,p,m,v){const M=new t(16);return void 0!==e&&(M[0]=e,void 0!==n&&(M[1]=n,void 0!==r&&(M[2]=r,void 0!==i&&(M[3]=i,void 0!==o&&(M[4]=o,void 0!==a&&(M[5]=a,void 0!==s&&(M[6]=s,void 0!==u&&(M[7]=u,void 0!==c&&(M[8]=c,void 0!==l&&(M[9]=l,void 0!==h&&(M[10]=h,void 0!==f&&(M[11]=f,void 0!==d&&(M[12]=d,void 0!==p&&(M[13]=p,void 0!==m&&(M[14]=m,void 0!==v&&(M[15]=v)))))))))))))))),M},determinant:function(t){const e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15],M=h*v,g=m*f,_=s*v,w=m*u,y=s*f,b=h*u,x=r*v,P=m*i,S=r*f,D=h*i,G=r*u,O=s*i;return e*(M*a+w*l+y*p-(g*a+_*l+b*p))+o*(g*n+x*l+D*p-(M*n+P*l+S*p))+c*(_*n+P*a+G*p-(w*n+x*a+O*p))+d*(b*n+S*a+O*l-(y*n+D*a+G*l))},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a&&Math.abs(t[4]-e[4])<a&&Math.abs(t[5]-e[5])<a&&Math.abs(t[6]-e[6])<a&&Math.abs(t[7]-e[7])<a&&Math.abs(t[8]-e[8])<a&&Math.abs(t[9]-e[9])<a&&Math.abs(t[10]-e[10])<a&&Math.abs(t[11]-e[11])<a&&Math.abs(t[12]-e[12])<a&&Math.abs(t[13]-e[13])<a&&Math.abs(t[14]-e[14])<a&&Math.abs(t[15]-e[15])<a},fromMat3:function(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=0,r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=0,r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},fromQuat:function(e,n){const r=n??new t(16),i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,l=a+a,h=i*u,f=o*u,d=o*c,p=a*u,m=a*c,v=a*l,M=s*u,g=s*c,_=s*l;return r[0]=1-d-v,r[1]=f+_,r[2]=p-g,r[3]=0,r[4]=f-_,r[5]=1-h-v,r[6]=m+M,r[7]=0,r[8]=p+g,r[9]=m-M,r[10]=1-h-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},frustum:function(e,n,r,i,o,a,s){const u=s??new t(16),c=n-e,l=i-r,h=o-a;return u[0]=2*o/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*o/l,u[6]=0,u[7]=0,u[8]=(e+n)/c,u[9]=(i+r)/l,u[10]=a/h,u[11]=-1,u[12]=0,u[13]=0,u[14]=o*a/h,u[15]=0,u},frustumReverseZ:function(e,n,r,i,o,a=1/0,s){const u=s??new t(16),c=n-e,l=i-r;if(u[0]=2*o/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*o/l,u[6]=0,u[7]=0,u[8]=(e+n)/c,u[9]=(i+r)/l,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,a===1/0)u[10]=0,u[14]=o;else{const t=1/(a-o);u[10]=o*t,u[14]=a*o*t}return u},getAxis:function(t,n,r){const i=r??e.create(),o=4*n;return i[0]=t[o+0],i[1]=t[o+1],i[2]=t[o+2],i},getScaling:function(t,n){const r=n??e.create(),i=t[0],o=t[1],a=t[2],s=t[4],u=t[5],c=t[6],l=t[8],h=t[9],f=t[10];return r[0]=Math.sqrt(i*i+o*o+a*a),r[1]=Math.sqrt(s*s+u*u+c*c),r[2]=Math.sqrt(l*l+h*h+f*f),r},getTranslation:function(t,n){const r=n??e.create();return r[0]=t[12],r[1]=t[13],r[2]=t[14],r},identity:s,inverse:u,invert:c,lookAt:function(n,r,i,o){const a=o??new t(16);return e.normalize(e.subtract(n,r,m),m),e.normalize(e.cross(i,m,d),d),e.normalize(e.cross(m,d,p),p),a[0]=d[0],a[1]=p[0],a[2]=m[0],a[3]=0,a[4]=d[1],a[5]=p[1],a[6]=m[1],a[7]=0,a[8]=d[2],a[9]=p[2],a[10]=m[2],a[11]=0,a[12]=-(d[0]*n[0]+d[1]*n[1]+d[2]*n[2]),a[13]=-(p[0]*n[0]+p[1]*n[1]+p[2]*n[2]),a[14]=-(m[0]*n[0]+m[1]*n[1]+m[2]*n[2]),a[15]=1,a},mul:f,mulScalar:r,multiply:l,multiplyScalar:n,negate:function(e,n){const r=n??new t(16);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[7]=-e[7],r[8]=-e[8],r[9]=-e[9],r[10]=-e[10],r[11]=-e[11],r[12]=-e[12],r[13]=-e[13],r[14]=-e[14],r[15]=-e[15],r},ortho:function(e,n,r,i,o,a,s){const u=s??new t(16);return u[0]=2/(n-e),u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2/(i-r),u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1/(o-a),u[11]=0,u[12]=(n+e)/(e-n),u[13]=(i+r)/(r-i),u[14]=o/(o-a),u[15]=1,u},perspective:function(e,n,r,i,o){const a=o??new t(16),s=Math.tan(.5*Math.PI-.5*e);if(a[0]=s/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,Number.isFinite(i)){const t=1/(r-i);a[10]=i*t,a[14]=i*r*t}else a[10]=-1,a[14]=-r;return a},perspectiveReverseZ:function(e,n,r,i=1/0,o){const a=o??new t(16),s=1/Math.tan(.5*e);if(a[0]=s/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,i===1/0)a[10]=0,a[14]=r;else{const t=1/(i-r);a[10]=r*t,a[14]=i*r*t}return a},rotate:M,rotateX:function(e,n,r){const i=r??new t(16),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=Math.cos(n),p=Math.sin(n);return i[4]=d*o+p*c,i[5]=d*a+p*l,i[6]=d*s+p*h,i[7]=d*u+p*f,i[8]=d*c-p*o,i[9]=d*l-p*a,i[10]=d*h-p*s,i[11]=d*f-p*u,e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},rotateY:function(e,n,r){const i=r??new t(16),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],h=e[10],f=e[11],d=Math.cos(n),p=Math.sin(n);return i[0]=d*o-p*c,i[1]=d*a-p*l,i[2]=d*s-p*h,i[3]=d*u-p*f,i[8]=d*c+p*o,i[9]=d*l+p*a,i[10]=d*h+p*s,i[11]=d*f+p*u,e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},rotateZ:function(e,n,r){const i=r??new t(16),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],f=e[7],d=Math.cos(n),p=Math.sin(n);return i[0]=d*o+p*c,i[1]=d*a+p*l,i[2]=d*s+p*h,i[3]=d*u+p*f,i[4]=d*c-p*o,i[5]=d*l-p*a,i[6]=d*h-p*s,i[7]=d*f-p*u,e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},rotation:v,rotationX:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotationY:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rotationZ:function(e,n){const r=n??new t(16),i=Math.cos(e),o=Math.sin(e);return r[0]=i,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},scale:function(e,n,r){const i=r??new t(16),o=n[0],a=n[1],s=n[2];return i[0]=o*e[0],i[1]=o*e[1],i[2]=o*e[2],i[3]=o*e[3],i[4]=a*e[4],i[5]=a*e[5],i[6]=a*e[6],i[7]=a*e[7],i[8]=s*e[8],i[9]=s*e[9],i[10]=s*e[10],i[11]=s*e[11],e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},scaling:function(e,n){const r=n??new t(16);return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},set:function(e,n,r,i,o,a,s,u,c,l,h,f,d,p,m,v,M){const g=M??new t(16);return g[0]=e,g[1]=n,g[2]=r,g[3]=i,g[4]=o,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=l,g[10]=h,g[11]=f,g[12]=d,g[13]=p,g[14]=m,g[15]=v,g},setAxis:function(t,e,n,r){const o=r===t?r:i(t,r),a=4*n;return o[a+0]=e[0],o[a+1]=e[1],o[a+2]=e[2],o},setTranslation:function(t,e,n){const r=n??s();return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},translate:function(e,n,r){const i=r??new t(16),o=n[0],a=n[1],s=n[2],u=e[0],c=e[1],l=e[2],h=e[3],f=e[4],d=e[5],p=e[6],m=e[7],v=e[8],M=e[9],g=e[10],_=e[11],w=e[12],y=e[13],b=e[14],x=e[15];return e!==i&&(i[0]=u,i[1]=c,i[2]=l,i[3]=h,i[4]=f,i[5]=d,i[6]=p,i[7]=m,i[8]=v,i[9]=M,i[10]=g,i[11]=_),i[12]=u*o+f*a+v*s+w,i[13]=c*o+d*a+M*s+y,i[14]=l*o+p*a+g*s+b,i[15]=h*o+m*a+_*s+x,i},translation:function(e,n){const r=n??new t(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},transpose:function(e,n){const r=n??new t(16);if(r===e){let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,r}const i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],c=e[5],l=e[6],h=e[7],f=e[8],d=e[9],p=e[10],m=e[11],v=e[12],M=e[13],g=e[14],_=e[15];return r[0]=i,r[1]=u,r[2]=f,r[3]=v,r[4]=o,r[5]=c,r[6]=d,r[7]=M,r[8]=a,r[9]=l,r[10]=p,r[11]=g,r[12]=s,r[13]=h,r[14]=m,r[15]=_,r},uniformScale:function(e,n,r){const i=r??new t(16);return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=n*e[6],i[7]=n*e[7],i[8]=n*e[8],i[9]=n*e[9],i[10]=n*e[10],i[11]=n*e[11],e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i},uniformScaling:function(e,n){const r=n??new t(16);return r[0]=e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}}}(t),p.set(t,e)),e}const v=new Map;function M(t){let e=v.get(t);return e||(e=function(t){const e=h(t);function n(e,n,r,i){const o=new t(4);return void 0!==e&&(o[0]=e,void 0!==n&&(o[1]=n,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}const r=n;function i(e,n,r){const i=r??new t(4),o=.5*n,a=Math.sin(o);return i[0]=a*e[0],i[1]=a*e[1],i[2]=a*e[2],i[3]=Math.cos(o),i}function o(e,n,r){const i=r??new t(4),o=e[0],a=e[1],s=e[2],u=e[3],c=n[0],l=n[1],h=n[2],f=n[3];return i[0]=o*f+u*c+a*h-s*l,i[1]=a*f+u*l+s*c-o*h,i[2]=s*f+u*h+o*l-a*c,i[3]=u*f-o*c-a*l-s*h,i}const s=o;function u(e,n,r,i){const o=i??new t(4),s=e[0],u=e[1],c=e[2],l=e[3];let h,f,d=n[0],p=n[1],m=n[2],v=n[3],M=s*d+u*p+c*m+l*v;if(M<0&&(M=-M,d=-d,p=-p,m=-m,v=-v),1-M>a){const t=Math.acos(M),e=Math.sin(t);h=Math.sin((1-r)*t)/e,f=Math.sin(r*t)/e}else h=1-r,f=r;return o[0]=h*s+f*d,o[1]=h*u+f*p,o[2]=h*c+f*m,o[3]=h*l+f*v,o}function c(e,n){const r=n??new t(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}const l=c;function f(e,n,r){const i=r??new t(4);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}const d=f;function p(e,n,r){const i=r??new t(4);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}const m=p;function v(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function M(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}const g=M;function _(t){const e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}const w=_;function y(e,n){const r=n??new t(4),i=e[0],o=e[1],a=e[2],s=e[3],u=Math.sqrt(i*i+o*o+a*a+s*s);return u>1e-5?(r[0]=i/u,r[1]=o/u,r[2]=a/u,r[3]=s/u):(r[0]=0,r[1]=0,r[2]=0,r[3]=1),r}const b=e.create(),x=e.create(),P=e.create(),S=new t(4),D=new t(4);return{create:n,fromValues:r,set:function(e,n,r,i,o){const a=o??new t(4);return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a},fromAxisAngle:i,toAxisAngle:function(t,n){const r=n??e.create(3),i=2*Math.acos(t[3]),o=Math.sin(.5*i);return o>a?(r[0]=t[0]/o,r[1]=t[1]/o,r[2]=t[2]/o):(r[0]=1,r[1]=0,r[2]=0),{angle:i,axis:r}},angle:function(t,e){const n=v(t,e);return Math.acos(2*n*n-1)},multiply:o,mul:s,rotateX:function(e,n,r){const i=r??new t(4),o=.5*n,a=e[0],s=e[1],u=e[2],c=e[3],l=Math.sin(o),h=Math.cos(o);return i[0]=a*h+c*l,i[1]=s*h+u*l,i[2]=u*h-s*l,i[3]=c*h-a*l,i},rotateY:function(e,n,r){const i=r??new t(4),o=.5*n,a=e[0],s=e[1],u=e[2],c=e[3],l=Math.sin(o),h=Math.cos(o);return i[0]=a*h-u*l,i[1]=s*h+c*l,i[2]=u*h+a*l,i[3]=c*h-s*l,i},rotateZ:function(e,n,r){const i=r??new t(4),o=.5*n,a=e[0],s=e[1],u=e[2],c=e[3],l=Math.sin(o),h=Math.cos(o);return i[0]=a*h+s*l,i[1]=s*h-a*l,i[2]=u*h+c*l,i[3]=c*h-u*l,i},slerp:u,inverse:function(e,n){const r=n??new t(4),i=e[0],o=e[1],a=e[2],s=e[3],u=i*i+o*o+a*a+s*s,c=u?1/u:0;return r[0]=-i*c,r[1]=-o*c,r[2]=-a*c,r[3]=s*c,r},conjugate:function(e,n){const r=n??new t(4);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},fromMat:function(e,n){const r=n??new t(4),i=e[0]+e[5]+e[10];if(i>0){const t=Math.sqrt(i+1);r[3]=.5*t;const n=.5/t;r[0]=(e[6]-e[9])*n,r[1]=(e[8]-e[2])*n,r[2]=(e[1]-e[4])*n}else{let t=0;e[5]>e[0]&&(t=1),e[10]>e[4*t+t]&&(t=2);const n=(t+1)%3,i=(t+2)%3,o=Math.sqrt(e[4*t+t]-e[4*n+n]-e[4*i+i]+1);r[t]=.5*o;const a=.5/o;r[3]=(e[4*n+i]-e[4*i+n])*a,r[n]=(e[4*n+t]+e[4*t+n])*a,r[i]=(e[4*i+t]+e[4*t+i])*a}return r},fromEuler:function(e,n,r,i,o){const a=o??new t(4),s=.5*e,u=.5*n,c=.5*r,l=Math.sin(s),h=Math.cos(s),f=Math.sin(u),d=Math.cos(u),p=Math.sin(c),m=Math.cos(c);switch(i){case"xyz":a[0]=l*d*m+h*f*p,a[1]=h*f*m-l*d*p,a[2]=h*d*p+l*f*m,a[3]=h*d*m-l*f*p;break;case"xzy":a[0]=l*d*m-h*f*p,a[1]=h*f*m-l*d*p,a[2]=h*d*p+l*f*m,a[3]=h*d*m+l*f*p;break;case"yxz":a[0]=l*d*m+h*f*p,a[1]=h*f*m-l*d*p,a[2]=h*d*p-l*f*m,a[3]=h*d*m+l*f*p;break;case"yzx":a[0]=l*d*m+h*f*p,a[1]=h*f*m+l*d*p,a[2]=h*d*p-l*f*m,a[3]=h*d*m-l*f*p;break;case"zxy":a[0]=l*d*m-h*f*p,a[1]=h*f*m+l*d*p,a[2]=h*d*p+l*f*m,a[3]=h*d*m-l*f*p;break;case"zyx":a[0]=l*d*m-h*f*p,a[1]=h*f*m+l*d*p,a[2]=h*d*p-l*f*m,a[3]=h*d*m+l*f*p;break;default:throw new Error(`Unknown rotation order: ${i}`)}return a},copy:c,clone:l,add:function(e,n,r){const i=r??new t(4);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},subtract:f,sub:d,mulScalar:p,scale:m,divScalar:function(e,n,r){const i=r??new t(4);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i[3]=e[3]/n,i},dot:v,lerp:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o[3]=e[3]+r*(n[3]-e[3]),o},length:M,len:g,lengthSq:_,lenSq:w,normalize:y,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},identity:function(e){const n=e??new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},rotationTo:function(n,r,o){const a=o??new t(4),s=e.dot(n,r);return s<-.999999?(e.cross(x,n,b),e.len(b)<1e-6&&e.cross(P,n,b),e.normalize(b,b),i(b,Math.PI,a),a):s>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(e.cross(n,r,b),a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=1+s,y(a,a))},sqlerp:function(e,n,r,i,o,a){const s=a??new t(4);return u(e,i,o,S),u(n,r,o,D),u(S,D,2*o*(1-o),s),s}}}(t),v.set(t,e)),e}const g=new Map;function _(t){let e=g.get(t);return e||(e=function(t){function e(e,n,r,i){const o=new t(4);return void 0!==e&&(o[0]=e,void 0!==n&&(o[1]=n,void 0!==r&&(o[2]=r,void 0!==i&&(o[3]=i)))),o}function n(e,n,r){const i=r??new t(4);return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[3]=e[3]-n[3],i}function r(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r*(n[0]-e[0]),o[1]=e[1]+r*(n[1]-e[1]),o[2]=e[2]+r*(n[2]-e[2]),o[3]=e[3]+r*(n[3]-e[3]),o}function i(e,n,r){const i=r??new t(4);return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}function o(e,n){const r=n??new t(4);return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function s(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function u(t){const e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function c(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function l(t,e){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function h(e,n){const r=n??new t(4),i=e[0],o=e[1],a=e[2],s=e[3],u=Math.sqrt(i*i+o*o+a*a+s*s);return u>1e-5?(r[0]=i/u,r[1]=o/u,r[2]=a/u,r[3]=s/u):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function f(e,n){const r=n??new t(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function d(e,n,r){const i=r??new t(4);return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i}function p(e,n,r){const i=r??new t(4);return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i[3]=e[3]/n[3],i}function m(e,n,r){const o=r??new t(4);return h(e,o),i(o,n,o)}return{create:e,fromValues:e,set:function(e,n,r,i,o){const a=o??new t(4);return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a},ceil:function(e,n){const r=n??new t(4);return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r},floor:function(e,n){const r=n??new t(4);return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r},round:function(e,n){const r=n??new t(4);return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r},clamp:function(e,n=0,r=1,i){const o=i??new t(4);return o[0]=Math.min(r,Math.max(n,e[0])),o[1]=Math.min(r,Math.max(n,e[1])),o[2]=Math.min(r,Math.max(n,e[2])),o[3]=Math.min(r,Math.max(n,e[3])),o},add:function(e,n,r){const i=r??new t(4);return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3]+n[3],i},addScaled:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+n[0]*r,o[1]=e[1]+n[1]*r,o[2]=e[2]+n[2]*r,o[3]=e[3]+n[3]*r,o},subtract:n,sub:n,equalsApproximately:function(t,e){return Math.abs(t[0]-e[0])<a&&Math.abs(t[1]-e[1])<a&&Math.abs(t[2]-e[2])<a&&Math.abs(t[3]-e[3])<a},equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},lerp:r,lerpV:function(e,n,r,i){const o=i??new t(4);return o[0]=e[0]+r[0]*(n[0]-e[0]),o[1]=e[1]+r[1]*(n[1]-e[1]),o[2]=e[2]+r[2]*(n[2]-e[2]),o[3]=e[3]+r[3]*(n[3]-e[3]),o},max:function(e,n,r){const i=r??new t(4);return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i[3]=Math.max(e[3],n[3]),i},min:function(e,n,r){const i=r??new t(4);return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i[3]=Math.min(e[3],n[3]),i},mulScalar:i,scale:i,divScalar:function(e,n,r){const i=r??new t(4);return i[0]=e[0]/n,i[1]=e[1]/n,i[2]=e[2]/n,i[3]=e[3]/n,i},inverse:o,invert:o,dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},length:s,len:s,lengthSq:u,lenSq:u,distance:c,dist:c,distanceSq:l,distSq:l,normalize:h,negate:function(e,n){const r=n??new t(4);return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r},copy:f,clone:f,multiply:d,mul:d,divide:p,div:p,zero:function(e){const n=e??new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},transformMat4:function(e,n,r){const i=r??new t(4),o=e[0],a=e[1],s=e[2],u=e[3];return i[0]=n[0]*o+n[4]*a+n[8]*s+n[12]*u,i[1]=n[1]*o+n[5]*a+n[9]*s+n[13]*u,i[2]=n[2]*o+n[6]*a+n[10]*s+n[14]*u,i[3]=n[3]*o+n[7]*a+n[11]*s+n[15]*u,i},setLength:m,truncate:function(e,n,r){const i=r??new t(4);return s(e)>n?m(e,n,i):f(e,i)},midpoint:function(e,n,i){return r(e,n,.5,i??new t(4))}}}(t),g.set(t,e)),e}function w(t,e,n,r,i,o){return{mat3:d(t),mat4:m(e),quat:M(n),vec2:c(r),vec3:h(i),vec4:_(o)}}const{mat3:y,mat4:b,quat:x,vec2:P,vec3:S,vec4:D}=w(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat3:G,mat4:O,quat:U,vec2:T,vec3:j,vec4:C}=w(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat3:q,mat4:A,quat:B,vec2:V,vec3:L,vec4:z}=w(r,Array,Array,Array,Array,Array)},722:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Geometry=e.BigTriangle=e.CubeGeometry=void 0;var r=n(161);Object.defineProperty(e,"CubeGeometry",{enumerable:!0,get:function(){return r.CubeGeometry}});var i=n(657);Object.defineProperty(e,"BigTriangle",{enumerable:!0,get:function(){return i.BigTriangle}});var o=n(80);Object.defineProperty(e,"Geometry",{enumerable:!0,get:function(){return o.Geometry}})},760:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UVMaterial=e.ShaderMaterial=e.BasicMaterial=e.Material=void 0;var r=n(35);Object.defineProperty(e,"Material",{enumerable:!0,get:function(){return r.Material}});var i=n(838);Object.defineProperty(e,"BasicMaterial",{enumerable:!0,get:function(){return i.BasicMaterial}});var o=n(941);Object.defineProperty(e,"ShaderMaterial",{enumerable:!0,get:function(){return o.ShaderMaterial}});var a=n(331);Object.defineProperty(e,"UVMaterial",{enumerable:!0,get:function(){return a.UVMaterial}})},779:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OrthographicCamera=void 0;const r=n(717),i=n(534);class o extends i.Camera{constructor({left:t=-1,right:e=1,bottom:n=-1,top:i=1,near:o=.1,far:a=1e3,position:s=r.vec3.create(0,0,10),target:u=r.vec3.create(0,0,0),up:c=r.vec3.create(0,1,0)}={}){super(),this.left=t,this.right=e,this.bottom=n,this.top=i,this.near=o,this.far=a,this.position=r.vec3.clone(s),this.target=r.vec3.clone(u),this.up=r.vec3.clone(c)}updateProjectionMatrix(){console.log("Updating Orthographic Projection Matrix using wgpu-matrix"),this._projectionMatrix=r.mat4.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this._isProjectionDirty=!1}updateViewMatrix(){console.log("Updating View Matrix using wgpu-matrix"),this._viewMatrix=r.mat4.lookAt(this.position,this.target,this.up),this._isViewDirty=!1}setPosition(t){r.vec3.equals(this.position,t)||(this.position=r.vec3.copy(t,this.position),this._isViewDirty=!0)}setTarget(t){r.vec3.equals(this.target,t)||(this.target=r.vec3.copy(t,this.target),this._isViewDirty=!0)}setUp(t){r.vec3.equals(this.up,t)||(this.up=r.vec3.copy(t,this.up),this._isViewDirty=!0)}setLeft(t){this.left!==t&&(this.left=t,this._isProjectionDirty=!0)}setRight(t){this.right!==t&&(this.right=t,this._isProjectionDirty=!0)}setBottom(t){this.bottom!==t&&(this.bottom=t,this._isProjectionDirty=!0)}setTop(t){this.top!==t&&(this.top=t,this._isProjectionDirty=!0)}setNear(t){this.near!==t&&(this.near=t,this._isProjectionDirty=!0)}setFar(t){this.far!==t&&(this.far=t,this._isProjectionDirty=!0)}viewportResized(t){}}e.OrthographicCamera=o},838:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.BasicMaterial=void 0;const i=n(710),o=n(330),a=n(35),s=n(343),u=r(n(414)),c=r(n(43));class l extends a.Material{constructor(t,e={}){l.precompile(t),super(new s.UniformManager(t,[{name:"color",value:(e.color||new i.Color(1,1,1)).uniformValue()}],[e.map||o.DefaultTexture.instance],"BasicMaterial"))}get cacheKey(){return"basic-material"}get shaderCode(){return l.shaderModule}static precompile(t){l.shaderModule||(l.shaderModule=t.createShaderModule({label:"basic-material-shader",code:`\n${u.default}\n${c.default}\n`}))}}e.BasicMaterial=l,l.shaderModule=null},898:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ComputeTask=void 0;const r=n(717);e.ComputeTask=class{constructor(t){this._options=t}get cacheKey(){if(this._cacheKey)return this._cacheKey;const t=[this.label,this._options.shader.label,this._options.entryPoint];for(const e of this._options.buffers)t.push(e.buffer.label);for(const e of this._options.textures)t.push(e.texture.label);return this._cacheKey=t.join(":"),this._cacheKey}get shaderModule(){return this._options.shader}get label(){return this._options.label||"Compute Task"}get workgroupSize(){return this._options.workgroupSize||r.vec3.create(8,8,1)}get bindGroupLayoutDescriptor(){const t=[];let e=0;const{textures:n,buffers:r,samplers:i}=this._options;if((null==i?void 0:i.length)>0)for(let n=0;n<(null==i?void 0:i.length);n++)t.push({binding:e,visibility:GPUShaderStage.COMPUTE,sampler:{type:i[n].type}}),e++;if((null==n?void 0:n.length)>0)for(let r=0;r<(null==n?void 0:n.length);r++)t.push({binding:e,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}}),e++;if((null==r?void 0:r.length)>0)for(let n=0;n<(null==r?void 0:r.length);n++)t.push({binding:e,visibility:GPUShaderStage.COMPUTE,buffer:{type:r[n].type}}),e++;return{label:`${this.label} BindGroup Layout`,entries:t}}get bindGroupEntries(){let t=0;const{textures:e,buffers:n,samplers:r}=this._options,i=[];if((null==r?void 0:r.length)>0)for(let e=0;e<(null==r?void 0:r.length);e++)i.push({binding:t,resource:r[e].sampler}),t++;if((null==e?void 0:e.length)>0)for(let n=0;n<(null==e?void 0:e.length);n++)i.push({binding:t,resource:e[n].texture.view}),t++;if((null==n?void 0:n.length)>0)for(let e=0;e<(null==n?void 0:n.length);e++)i.push({binding:t,resource:{buffer:n[e].buffer}}),t++;return i}getBindGroupLayout(t){return this._bindGroupLayout||(this._bindGroupLayout=t.createBindGroupLayout(this.bindGroupLayoutDescriptor)),this._bindGroupLayout}getBindGroup(t){return this._bindGroup||(this._bindGroup=t.createBindGroup({label:this.label,layout:this._bindGroupLayout,entries:this.bindGroupEntries})),this._bindGroup}}},941:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderMaterial=void 0;const i=n(35),o=n(343),a=r(n(414));class s extends i.Material{constructor(t,e){super(new o.UniformManager(t,e.uniforms,e.textures,"ShaderMaterial")),this._options=e,this.compile(t)}compile(t){this._shaderModule=t.createShaderModule({label:"ShaderModule",code:`\n${a.default}\n${this._options.code}\n      `})}get cacheKey(){return btoa(this._options.code)}get shaderCode(){return this._shaderModule}}e.ShaderMaterial=s}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}return n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(325)})()));