<!doctype html>
<html>

<head>
    <title>tinygpu example: Hello World</title>
    <style type="text/css">
body {
    margin: 0;
    overflow: hidden;
}

canvas {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
}
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script src="../dist/index.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", async () => {
    const canvas = document.getElementById("canvas");
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    const renderer = new tinygpu.Renderer({ canvas });
    await renderer.init();

    const scene = renderer.createScene();
    const camera = renderer.createPerspectiveCamera();

    class CustomGeometry extends tinygpu.geometry.Geometry {
        constructor(renderer) {
            const vertices = [
                -1,  1, 0,
                -1, -1, 0,
                 1,  1, 0,
                 1, -1, 0
            ];

            const indices = [ 0, 1, 2, 1, 3, 2 ];

            const uvs = [
                  0, 1,
                  0, 0,
                  1, 1,
                  1, 0
            ];

            super(
                renderer,
                renderer.createBuffer(new Float32Array(vertices), GPUBufferUsage.VERTEX),
                renderer.createBuffer(new Uint16Array(indices), GPUBufferUsage.INDEX),
                renderer.createBuffer(new Float32Array(uvs), GPUBufferUsage.VERTEX),
                6, // Index count
                4  // Vertex count
            );
        }

        get cacheKey() {
            return "my-triangle";
        }

        get bufferLayout() {
            return [
                { // vertices
                    attributes: [
                        {
                            shaderLocation: 0,
                            offset: 0,
                            format: "float32x3",
                        }
                    ],
                    arrayStride: 3 * 4,
                    stepMode: "vertex",
                },
                { // uvs
                    attributes: [
                        {
                            shaderLocation: 1,
                            offset: 0,
                            format: "float32x2",
                        }
                    ],
                    arrayStride: 2 * 4,
                    stepMode: "vertex",
                }
            ]
        }
    };

    const geo = renderer.createGeometry(CustomGeometry);
    const mat = renderer.createMaterial(tinygpu.material.UVMaterial);
    const mesh = renderer.createMesh(geo, mat);

    scene.add(mesh);

    const animate = () => {
        const now = performance.now() / 1000;
        mesh.setRotation(0, 0, now * 0.7);
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
    };

    animate();
});
    </script>
</body>

</html>